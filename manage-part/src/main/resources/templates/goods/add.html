<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>商品新增</title>
    <link rel="stylesheet" href="/static/layui/css/layui.css">
    <script src="/static/layui/layui.all.js"></script>
</head>
<body>
<form class="layui-form">
    <div class="layui-form-item" style="margin-top: 20px;">
        <div class="layui-inline" >
            <label class="layui-form-label">类型</label>
            <div class="layui-input-inline" style="width: 200px;">
                <select  lay-filter="mold" lay-verify="required">
                    <option value="">请选择一个类型</option>
                    <option value="clothes">衣物</option>
                    <option value="bag">箱包</option>
                    <option value="phone">手机</option>
                </select>
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">分类</label>
            <div class="layui-input-inline" style="width: 200px;">
                <select id="type" name="goodsType" lay-filter="type" lay-verify="required">
                    <option value="">请选择一个类型</option>
                </select>
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">商品名</label>
            <div class="layui-input-inline" style="width: 200px;">
                <input type="text" name="goodsName" autocomplete="off" class="layui-input" lay-verify="required">
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">库存</label>
            <div class="layui-input-inline" style="width: 200px;">
                <input type="text" name="goodsNum" autocomplete="off" class="layui-input" lay-verify="required">
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">单价</label>
            <div class="layui-input-inline" style="width: 200px;">
                <input type="text" name="goodsPrice" autocomplete="off" class="layui-input" lay-verify="required">
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">计量单位</label>
            <div class="layui-input-inline" style="width: 200px;">
                <input type="text" name="goodsTally" autocomplete="off" class="layui-input" lay-verify="required">
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">商品介绍</label>
            <div class="layui-input-inline" style="width: 200px;">
                <input type="text" name="goodsTitle" autocomplete="off" class="layui-input">
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-inline" style="width: 500px;">
            <label class="layui-form-label">商品详情</label>
            <div class="layui-input-block">
                <textarea name="goodsDesc" placeholder="请输入内容" class="layui-textarea"></textarea>
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-input-block">
            <button class="layui-btn" lay-submit lay-filter="addGoods">添加</button>
            <button type="reset" class="layui-btn layui-btn-primary" id="reset-btn">重置</button>
        </div>
    </div>
</form>
</body>
<script>
    var form;
    layui.use(['element','jquery','form'], function(){
        var element = layui.element;
        var $ = layui.$;
        form = layui.form;


        /**
         *  商品类型下拉监听
         */
         form.on('select(mold)', function(data){
             var dest = data.value ;
             if(dest === ""){
                 $('#type').html('<option value="">请选择一个类型</option>');
                 form.render('select');
                 return ;
             }
             $.ajax({
                 method: 'get'
                 ,url: '/static/json/'+ dest + ".json"
                 ,success: function (data) {
                     console.log(data);
                     // 动态赋值
                     var ops = '<option value="">请选择一个类型</option>';
                     for(var i in data){
                         ops += '<option value="'+ data[i].value +'">' + data[i].name + "</option>"
                     }
                     $('#type').html(ops);
                     form.render('select');
                 }
             })
         });

        /**
         * 新增商品
         */
        form.on('submit(addGoods)',function(data){
            $.ajax({
                type: 'POST'
                ,url: '/api/goods/add'
                ,contentType: "application/json;charset=UTF-8"
                ,data: JSON.stringify(data.field)
                ,success: function(response){
                    $('#reset-btn').click();
                    layer.alert("添加商品成功")

                }
                ,error:function(error){
                    layer.alert('未知异常')
                }
            });
            return false;
        })
    });
    (function () {
        form.render();
    })();
</script>
</html>